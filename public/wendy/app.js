class Title extends Phaser.Scene {
  constructor() {
    super({ key: "Title" });
  }

  preload() {
    this.load.image("start", "wendy/image/Default.png");
    this.load.image("hover", "wendy/image/Hover.png");
    this.load.image("logo", "wendy/image/logo.png");
    this.load.image("bg", "wendy/image/bg.png");
    this.load.audio("bgmusic", "wendy/image/bgmusic.mp3");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
  }

  create() {
    this.backgroundMusic = this.sound.add("bgmusic", { loop: true });
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    this.backgroundMusic.play();
    const bg = this.add.image(0, 0, "bg");
    this.logo = this.add.image(100, 280, "logo");
    this.logo.setDisplaySize(120, 25);
    this.add.text(185, 278, "Wendy Asmatico - 2024", {
      fontFamily: "Kode Mono",
      fontSize: 10,
      color: "white",
      border: "2px solid",
    });
    this.button = this.add.image(500, 150, "start");
    this.button.setInteractive();
    bg.setScale(1.5);
    this.add.text(350, 50, "ALTERNANCE QUEST", {
      fontFamily: "Kode Mono",
      fontSize: 30,
      color: "white",
      border: "2px solid",
    });

    this.button.on("pointerover", () => {
      this.button.setTexture("hover");
      this.select.play();
    });

    this.button.on("pointerout", () => {
      this.button.setTexture("start");
    });

    this.button.on("pointerdown", () => {
      this.press.play();
      this.changeScene();
    });
  }

  changeScene() {
    let scene = "CharacterSelection";
    this.scene.start(scene);
  }
}

class CharacterSelection extends Phaser.Scene {
  constructor() {
    super({ key: "CharacterSelection" });
  }

  preload() {
    this.load.image("LeonP", "wendy/image/LeonP.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.image("AlainP", "wendy/image/AlainP.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.image("ChloeP", "wendy/image/ChloeP.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
  }

  create() {
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    const bg = this.add.image(0, 0, "bg");
    bg.setScale(1.5);
    const character1 = this.add.image(400, 100, "LeonP").setInteractive();
    character1.setDisplaySize(200, 150);
    const character2 = this.add.image(600, 100, "AlainP").setInteractive();
    character2.setDisplaySize(200, 150);
    const character3 = this.add.image(800, 100, "ChloeP").setInteractive();
    character3.setDisplaySize(200, 150);
    this.add.text(30, 100, "Choisissez\nvotre personnage", {
      fontFamily: "Kode Mono",
      fontSize: 30,
      color: "white",
    });

    character1.on("pointerover", () => {
      this.select.play();
      character1.setTint(0xffffff);
      this.showCharacterName("Leon", 400, 200);
    });
    character1.on("pointerout", () => {
      character1.clearTint();
      this.hideCharacterName();
    });
    character1.on("pointerdown", () => {
      this.press.play();
      this.selectCharacter("Leon");
    });

    character2.on("pointerover", () => {
      this.select.play();
      character2.setTint(0xffffff);
      this.showCharacterName("Alain", 600, 200);
    });
    character2.on("pointerout", () => {
      character2.clearTint();
      this.hideCharacterName();
    });
    character2.on("pointerdown", () => {
      this.press.play();
      this.selectCharacter("Alain");
    });

    character3.on("pointerover", () => {
      this.select.play();
      character3.setTint(0xffffff);
      this.showCharacterName("Chloe", 800, 200);
    });
    character3.on("pointerout", () => {
      character3.clearTint();
      this.hideCharacterName();
    });

    character3.on("pointerdown", () => {
      this.press.play();
      this.selectCharacter("Chloe");
    });
  }
  selectCharacter(select) {
    let spriteKey;
    if (select === "Leon") {
      spriteKey = "Leon";
    } else if (select === "Alain") {
      spriteKey = "Alain";
    } else if (select === "Chloe") {
      spriteKey = "Chloe";
    }
    console.log(spriteKey);
    this.scene.start("Map", { selectedCharacter: spriteKey });
  }

  showCharacterName(name, x, y) {
    this.characterNameText = this.add.text(x, y, name, {
      fontFamily: "Kode Mono",
      fontSize: 20,
      color: "#ffffff",
    });
    this.characterNameText.setOrigin(0.5);
  }

  hideCharacterName() {
    if (this.characterNameText) {
      this.characterNameText.destroy();
    }
  }
}
class Map extends Phaser.Scene {
  constructor() {
    super({ key: "Map" });
    this.combatFait1 = false;
    this.combatFait2 = false;
    this.combatFait3 = false;
    this.combatFait4 = false;
  }

  preload() {
    this.load.spritesheet("Alain", "wendy/image/Alain.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.spritesheet("Chloe", "wendy/image/Chloe.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.spritesheet("Leon", "wendy/image/Leon.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.spritesheet("panneau", "wendy/image/panneau.png", {
      frameWidth: 32,
      frameHeight: 32,
    });
    this.load.image("deco", "wendy/image/ville.png");
    this.load.audio("press", "wendy/image/press.mp3");
    this.load.audio("step", "wendy/image/step.mp3");
  }

  create(data) {
    let combatFait1 = false;
    let combatFait2 = false;
    let combatFait3 = false;
    let combatFait4 = false;

    this.press = this.sound.add("press");
    this.step = this.sound.add("step");

    const selectedCharacter = data.selectedCharacter;
    const skyBG = this.add.image(0, 0, "deco").setOrigin(0).setScrollFactor(0);
    skyBG.displayWidth = 1500;
    skyBG.displayHeight = 300;
    this.player = this.physics.add.sprite(100, 290, selectedCharacter);

    this.player.setOrigin(0.75, 0.5);
    this.player.setSize(32, 32);
    this.player.body.collideWorldBounds = true;

    this.anims.create({
      key: "stand",
      frames: this.anims.generateFrameNumbers(selectedCharacter, {
        start: 1,
        end: 2,
      }),
      frameRate: 5,
      repeat: 1,
    });

    this.anims.create({
      key: "walkG",
      frames: this.anims.generateFrameNumbers(selectedCharacter, {
        start: 4,
        end: 5,
      }),
      frameRate: 5,
      repeat: 1,
    });

    this.anims.create({
      key: "walkD",
      frames: this.anims.generateFrameNumbers(selectedCharacter, {
        start: 7,
        end: 8,
      }),
      frameRate: 5,
      repeat: 1,
    });

    this.anims.create({
      key: "walkU",
      frames: this.anims.generateFrameNumbers(selectedCharacter, {
        start: 11,
        end: 11,
      }),
      frameRate: 5,
      repeat: 1,
    });

    this.cursors = this.input.keyboard.createCursorKeys();
    this.enterKey = this.input.keyboard.addKey(
      Phaser.Input.Keyboard.KeyCodes.ENTER
    );

    this.ice = this.add.image(150, 250, "panneau");
    this.barber = this.add.image(350, 250, "panneau");
    this.theatre = this.add.image(650, 250, "panneau");
    this.fish = this.add.image(910, 250, "panneau");
    this.questionText = this.add.text(
      275,
      25,
      "Appuyez sur entrÃ©e devant une porte pour faire votre entretien",
      {
        fontFamily: "Kode Mono",
        fontSize: 20,
        color: "black",
      }
    );
  }

  update() {
    if (this.cursors.left.isDown) {
      this.step.play();
      this.player.anims.play("walkG", true);
      this.player.setVelocityX(-75);
    } else if (this.cursors.right.isDown) {
      this.step.play();
      this.player.anims.play("walkD", true);
      this.player.setVelocityX(75);
    } else if (this.cursors.up.isDown) {
      this.step.play();
      this.player.anims.play("walkU");
    } else if (this.cursors.down.isDown) {
      this.step.play();
      this.player.anims.play("stand");
    } else {
      this.player.setVelocity(0);
    }

    if (
      this.player.x >= 200 &&
      this.player.x <= 250 &&
      this.player.y >= 280 &&
      this.player.y <= 300 &&
      this.enterKey.isDown
    ) {
      if (this.combatFait1 == false) {
        this.press.play();
        this.scene.start("Entretiens");
        this.combatFait1 = true;
      } else {
      }
    }
    if (
      this.player.x >= 400 &&
      this.player.x <= 450 &&
      this.player.y >= 280 &&
      this.player.y <= 300 &&
      this.enterKey.isDown
    ) {
      if (this.combatFait2 == false) {
        this.press.play();
        this.scene.start("Entretiens2");
        this.combatFait2 = true;
      } else {
      }
    }
    if (
      this.player.x >= 680 &&
      this.player.x <= 730 &&
      this.player.y >= 280 &&
      this.player.y <= 300 &&
      this.enterKey.isDown
    ) {
      if (this.combatFait3 == false) {
        this.press.play();
        this.scene.start("Entretiens3");
        this.combatFait3 = true;
      } else {
      }
    }

    if (
      this.player.x >= 950 &&
      this.player.x <= 990 &&
      this.player.y >= 280 &&
      this.player.y <= 300 &&
      this.enterKey.isDown
    ) {
      if (this.combatFait4 == false) {
        this.press.play();
        this.scene.start("Entretiens4");
        this.combatFait4 = true;
      } else {
      }
    }
  }
}
class HealthBar {
  constructor(scene, x, y, width, height) {
    this.bar = new Phaser.GameObjects.Graphics(scene);

    this.x = x;
    this.y = y;
    this.width = width; // Nouvelle largeur de la barre
    this.height = height; // Nouvelle hauteur de la barre
    this.value = 100;
    this.p = this.width / 100;

    this.draw();

    scene.add.existing(this.bar);
  }

  decrease(amount) {
    this.value -= amount;

    if (this.value < 0) {
      this.value = 0;
    }

    this.draw();

    return this.value === 0;
  }

  draw() {
    this.bar.clear();

    //  BG
    this.bar.fillStyle(0x000000);
    this.bar.fillRect(this.x, this.y, this.width, this.height);

    //  Health

    this.bar.fillStyle(0xffffff);
    this.bar.fillRect(this.x + 2, this.y + 2, this.width - 2, this.height - 2);

    if (this.value < 30) {
      this.bar.fillStyle(0xff0000);
    } else {
      this.bar.fillStyle(0x00ff00);
    }

    var d = Math.floor(this.p * this.value);

    this.bar.fillRect(this.x + 2, this.y + 2, d, this.height - 2);
  }
}

class Entretiens extends Phaser.Scene {
  constructor() {
    super({ key: "Entretiens" });
  }
  preload() {
    this.load.image("shopIce", "wendy/image/shop.png");
    this.load.image("sellerIce", "wendy/image/seller.png");
    this.load.image("dialogueBox", "wendy/image/metalPanel.png");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
    this.load.audio("hurt", "wendy/image/hurt.mp3");
  }

  create() {
    const Ice = this.add.image(0, 0, "shopIce").setOrigin(0).setScrollFactor(0);
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    this.hurt = this.sound.add("hurt");
    Ice.displayWidth = 1000;
    Ice.displayHeight = 300;
    this.dialogueBox = this.add.image(310, 100, "dialogueBox");
    this.dialogueBox.setDisplaySize(550, 150);
    this.sellerIce = this.add.image(750, 150, "sellerIce");
    this.sellerIce.setDisplaySize(300, 250);
    this.healthBarE = new HealthBar(this, 125, 50, 200, 15);
    this.add.text(360, 50, "Recruteur", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });

    this.dialogueBoxP = this.add.image(760, 220, "dialogueBox");
    this.dialogueBoxP.setDisplaySize(310, 90);
    this.healthBarP = new HealthBar(this, 650, 190, 200, 15);
    this.add.text(670, 220, "Candidat", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });
    this.enemyHP = 100;
    this.playerHP = 100;

    this.dialogueBoxR = this.add.image(310, 250, "dialogueBox");
    this.dialogueBoxR.setDisplaySize(450, 90);

    this.questions = [
      {
        question: "Comment abordez-vous les conflits ?",
        options: [
          "En Ã©vitant le conflit",
          "En confrontant",
          "En demandant une aide\ndu supÃ©rieur",
          " Laisser les autres\nmembres le faire",
        ],
        correctAnswer: 1,
      },
      {
        question:
          "Comment dÃ©cririez-vous votre capacitÃ©\nÃ  travailler sous pression ?",
        options: [
          "Je suis effondrÃ©",
          "Je cherche une aide",
          "Je reste calme",
          " Je deviens stressÃ©\nmais je continue",
        ],
        correctAnswer: 2,
      },
      {
        question:
          "Comment gÃ©rez-vous les stocks pour\nÃ©viter les pÃ©nuries ou les excÃ©dents ?",
        options: [
          "quand les\nstocks sont Ã©puisÃ©s.",
          "surveiller puis passer\ndes commandes anticipÃ©es",
          "Commander le mÃªme\nmontant",
          "En ne se prÃ©occupant pas",
        ],
        correctAnswer: 1,
      },
      {
        question:
          "Quels sont les ingrÃ©dients pour fabriquer\nune crÃ¨me glacÃ©e traditionnelle ?",
        options: [
          "Lait,crÃ¨me,sucre,\njaunes Åufs",
          "Eau,sucre,fruits frais",
          "Farine,sucre,\nÅufs,beurre",
          "Lait,sucre,\ncolorants artificiels",
        ],
        correctAnswer: 0,
      },
      {
        question: "Quel est votre niveau \nde sociabilitÃ© ?",
        options: [
          "TrÃ¨s introverti",
          "PlutÃ´t rÃ©servÃ©",
          "Assez extraverti",
          "TrÃ¨s extraverti",
        ],
        correctAnswer: 2,
      },
      {
        question: "Situation : Vous faites tomber\nvotre glace",
        options: [
          "Je rÃ¢le et cris",
          "Je nettoies vite",
          "Je laisse le\nstagiaire nettoyer",
          "Je refais une glace\npuis nettoies",
        ],
        correctAnswer: 1,
      },
      {
        question: "Hello, which ice cream would you\nrecommend?",
        options: [
          "Chocolate",
          "It costs five euros.",
          "Je ne comprends pas...",
          "The flavor of the day\nis caramel and apple",
        ],
        correctAnswer: 3,
      },
    ];
    this.currentQuestionIndex = 0;
    this.displayQuestion();
  }

  displayQuestion() {
    const currentQuestion = this.questions[this.currentQuestionIndex];
    this.questionText = this.add.text(110, 90, currentQuestion.question, {
      fontFamily: "Kode Mono",
      fontSize: 20,
      color: "black",
    });

    const optionsTexts = [];
    currentQuestion.options.forEach((option, index) => {
      let x, y;
      if (index < 2) {
        x = 130 + index * 200;
        y = 225;
      } else {
        x = 130 + (index - 2) * 200;
        y = 260;
      }
      const optionText = this.add
        .text(x, y, option, {
          fontFamily: "Kode Mono",
          fontSize: 14,
          color: "black",
        })
        .setInteractive();
      optionText.on("pointerover", () => {
        this.select.play();
        optionText.setColor("red");
      });
      optionText.on("pointerout", () => {
        optionText.setColor("black");
      });

      optionText.on("pointerdown", () => {
        this.press.play();
        this.checkAnswer(index);
        optionsTexts.forEach((text) => text.destroy());
      });
      optionsTexts.push(optionText);
    });
  }
  checkAnswer(selectedIndex) {
    const currentQuestion = this.questions[this.currentQuestionIndex];

    if (selectedIndex === currentQuestion.correctAnswer) {
      this.hurt.play();
      this.enemyHP -= 25;
      this.healthBarE.decrease(25);
      if (this.enemyHP <= 0) {
        this.scene.start("Victory");
      }
    } else {
      this.select.play();
      this.playerHP -= 25;
      this.healthBarP.decrease(25);

      if (this.playerHP <= 0) {
        this.scene.start("Defeat");
      }
    }
    this.currentQuestionIndex++;
    if (this.currentQuestionIndex < this.questions.length) {
      this.questionText.destroy();
      this.displayQuestion();
    } else {
    }
  }
}

class Entretiens2 extends Phaser.Scene {
  constructor() {
    super({ key: "Entretiens2" });
  }
  preload() {
    this.load.image("barbershop", "wendy/image/barberShop.png");
    this.load.image("barber", "wendy/image/barber.png");
    this.load.image("dialogueBox", "wendy/image/metalPanel.png");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
    this.load.audio("hurt", "wendy/image/hurt.mp3");
  }

  create() {
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    this.hurt = this.sound.add("hurt");
    const barber = this.add
      .image(0, 0, "barbershop")
      .setOrigin(0)
      .setScrollFactor(0);
    barber.displayWidth = 1000;
    barber.displayHeight = 300;
    this.dialogueBox = this.add.image(310, 100, "dialogueBox");
    this.dialogueBox.setDisplaySize(550, 150);
    this.barber = this.add.image(750, 100, "barber");
    this.barber.setDisplaySize(250, 200);
    this.healthBarE = new HealthBar(this, 125, 50, 200, 15);
    this.add.text(360, 50, "Recruteur", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });

    this.dialogueBoxP = this.add.image(760, 220, "dialogueBox");
    this.dialogueBoxP.setDisplaySize(310, 90);
    this.healthBarP = new HealthBar(this, 650, 190, 200, 15);
    this.add.text(670, 220, "Candidat", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });
    this.enemyHP = 100;
    this.playerHP = 100;

    this.dialogueBoxR = this.add.image(310, 250, "dialogueBox");
    this.dialogueBoxR.setDisplaySize(450, 90);

    this.questions = [
      {
        question: "Comment interagissez-vous \navec les clients ?",
        options: [
          "Je lÃ¢che tout et je les \nsalue chaleureusement",
          "Je lance un regard froid\nparce que je suis occupÃ©",
          "Je les accueille mais\nje reste sur mon travail",
          " Je les ignore",
        ],
        correctAnswer: 2,
      },
      {
        question: "Quelle est votre attitude face\nÃ  l'apprentissage continu ?",
        options: [
          " je suis dÃ©jÃ  un expert",
          "J'aime apprendre de\nnouvelles techniques",
          "Je prÃ©fÃ¨re rester dans\nma zone de confort",
          "Je suis trop occupÃ©\npour me former",
        ],
        correctAnswer: 1,
      },
      {
        question: "Quelle est votre approche pour\ntravailler en Ã©quipe ?",
        options: [
          "Je cherche Ã  contribuer\naux tÃ¢ches d'Ã©quipe",
          "Je prÃ©fÃ¨re travailler\nseul",
          "Je critique souvent\nmes collÃ¨gues",
          "Je laisse mes collÃ¨gues\nfaire le travail",
        ],
        correctAnswer: 0,
      },
      {
        question:
          "Comment abordez-vous les situations \noÃ¹ un client n'est pas satisfait?",
        options: [
          "Je me sens mal Ã  l'aise.",
          "Je demande au client \nde partir",
          "Je refuse de faire\ndes modifications",
          "Je propose d'amÃ©liorer \nla coupe",
        ],
        correctAnswer: 3,
      },
      {
        question: "Comment rÃ©agissez-vous face Ã  un client \nqui est stressÃ© ?",
        options: [
          "Je lui dis de se calmer",
          "Je l'ignore et \nje continue mon travail ",
          "Je fais de mon mieux\npourle mettre Ã  l'aise.",
          " Je lui demande de\nquitter le salon",
        ],
        correctAnswer: 2,
      },
      {
        question: "Quelle est votre attitude \nface aux critiques ?",
        options: [
          "Je prends les critiques\npersonnellement",
          "Je les rejette",
          "Je les considÃ¨re comme\ndes opportunitÃ©s",
          "Je rÃ©ponds pour \nme dÃ©fendre.",
        ],
        correctAnswer: 3,
      },
      {
        question: "Citez-moi une qualitÃ© ?",
        options: [
          "Je suis organisÃ©\net mÃ©ticuleux",
          "Je fais juste de mon \nmieux dans ce que je fais",
          "Je sais travailler\nen Ã©quipe",
          "Je suis extrÃªmement \ncrÃ©atif",
        ],
        correctAnswer: 0,
      },
    ];
    this.currentQuestionIndex = 0;
    this.displayQuestion();
  }

  displayQuestion() {
    const currentQuestion = this.questions[this.currentQuestionIndex];
    this.questionText = this.add.text(110, 90, currentQuestion.question, {
      fontFamily: "Kode Mono",
      fontSize: 20,
      color: "black",
    });

    const optionsTexts = [];

    currentQuestion.options.forEach((option, index) => {
      let x, y;
      if (index < 2) {
        x = 130 + index * 200;
        y = 225;
      } else {
        x = 130 + (index - 2) * 200;
        y = 260;
      }
      const optionText = this.add
        .text(x, y, option, {
          fontFamily: "Kode Mono",
          fontSize: 14,
          color: "black",
        })
        .setInteractive();
      optionText.on("pointerover", () => {
        this.select.play();
        optionText.setColor("red");
      });
      optionText.on("pointerout", () => {
        optionText.setColor("black");
      });

      optionText.on("pointerdown", () => {
        this.press.play();
        this.checkAnswer(index);
        optionsTexts.forEach((text) => text.destroy());
      });
      optionsTexts.push(optionText);
    });
  }
  checkAnswer(selectedIndex) {
    const currentQuestion = this.questions[this.currentQuestionIndex];

    if (selectedIndex === currentQuestion.correctAnswer) {
      this.hurt.play();
      this.enemyHP -= 25;
      this.healthBarE.decrease(25);
      if (this.enemyHP <= 0) {
        this.scene.start("Victory");
      }
    } else {
      this.hurt.play();
      this.playerHP -= 25;
      this.healthBarP.decrease(25);

      if (this.playerHP <= 0) {
        this.scene.start("Defeat");
      }
    }
    this.currentQuestionIndex++;
    if (this.currentQuestionIndex < this.questions.length) {
      this.questionText.destroy();
      this.displayQuestion();
    } else {
    }
  }
}

class Entretiens3 extends Phaser.Scene {
  constructor() {
    super({ key: "Entretiens3" });
  }
  preload() {
    this.load.image("theater", "wendy/image/theatre.png");
    this.load.image("director", "wendy/image/director.png");
    this.load.image("dialogueBox", "wendy/image/metalPanel.png");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
    this.load.audio("hurt", "wendy/image/hurt.mp3");
  }

  create() {
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    this.hurt = this.sound.add("hurt");
    const theater = this.add
      .image(0, 0, "theater")
      .setOrigin(0)
      .setScrollFactor(0);
    theater.displayWidth = 1000;
    theater.displayHeight = 300;
    this.dialogueBox = this.add.image(310, 100, "dialogueBox");
    this.dialogueBox.setDisplaySize(550, 150);
    this.director = this.add.image(750, 100, "director");
    this.director.setDisplaySize(250, 200);
    this.healthBarE = new HealthBar(this, 125, 50, 200, 15);
    this.add.text(360, 50, "Recruteur", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });

    this.dialogueBoxP = this.add.image(760, 220, "dialogueBox");
    this.dialogueBoxP.setDisplaySize(310, 90);
    this.healthBarP = new HealthBar(this, 650, 190, 200, 15);
    this.add.text(670, 220, "Candidat", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });
    this.enemyHP = 100;
    this.playerHP = 100;

    this.dialogueBoxR = this.add.image(310, 250, "dialogueBox");
    this.dialogueBoxR.setDisplaySize(450, 90);

    this.questions = [
      {
        question:
          "Quelle est votre principale motivation\npour postuler Ã  cette alternance ?",
        options: [
          " Gagner de l'expÃ©rience \nprofessionnelle.",
          "Obtenir un salaire.",
          "AcquÃ©rir des compÃ©tences\n dans le domaine.",
          "Faire plaisir Ã \nmes parents.",
        ],
        correctAnswer: 2,
      },
      {
        question:
          "Comment gÃ©rez-vous les situations\nde service clientÃ¨le dÃ©licates",
        options: [
          "En ignorant les clients\nmÃ©contents",
          "En Ã©coutant et en\ncherchant des solutions ",
          "En donnant toujours\nraison au client",
          " Je les ignore",
        ],
        correctAnswer: 1,
      },
      {
        question: "Quel est l'importance \nde la ponctualitÃ© ?",
        options: [
          "Pas trÃ¨s importante,\nsi le travail est fait",
          "TrÃ¨s importante!Aucune\nexpections est tolÃ©rable",
          "Elle est importante QUE\npour les temps plein",
          "C'est important pour\nle bon fonctionnement",
        ],
        correctAnswer: 3,
      },
      {
        question:
          "Quelles sont les tÃ¢ches pour votre\nalternance en gestions d'entreprise?",
        options: [
          " Vente de billets et\nalimentaire,nettoyage des salles",
          "Projection des films",
          "Planification des horaires\ngestion des stocks",
          " Gestion des rÃ©seaux \nsociaux et Ã©vÃ©nement",
        ],
        correctAnswer: 2,
      },
      {
        question: "Comment gÃ©rez-vous les pÃ©riodes\nde forte affluence ?",
        options: [
          "En prenant des pauses\npour Ã©viter le stress",
          "En demandant de l'aide et\nfaire les tÃ¢ches urgente",
          "RÃ©duire la charge de\ntravail",
          "En se cachant dans \nles coulisses",
        ],
        correctAnswer: 1,
      },
      {
        question:
          "Quelle est votre approche pour atteindre\nvos objectifs professionnels ?",
        options: [
          "En attendant que les\nopportunitÃ©s arrivent",
          "En comptant sur la\nchance pour rÃ©ussir.",
          "En Ã©tablissant des\nobjectifs clairs",
          "En travaillant de\nmaniÃ¨re proactive",
        ],
        correctAnswer: 3,
      },
      {
        question: "Quel est votre principal \ndÃ©faut selon vous ?",
        options: [
          "Je suis facilement\ndistrait",
          "Je suis perfectionniste",
          "Je suis trop compÃ©titif",
          "Je suis trÃ¨s impatient",
        ],
        correctAnswer: 2,
      },
    ];
    this.currentQuestionIndex = 0;
    this.displayQuestion();
  }

  displayQuestion() {
    const currentQuestion = this.questions[this.currentQuestionIndex];
    this.questionText = this.add.text(110, 90, currentQuestion.question, {
      fontFamily: "Kode Mono",
      fontSize: 20,
      color: "black",
    });

    const optionsTexts = [];

    currentQuestion.options.forEach((option, index) => {
      let x, y;
      if (index < 2) {
        x = 130 + index * 200;
        y = 225;
      } else {
        x = 130 + (index - 2) * 200;
        y = 260;
      }
      const optionText = this.add
        .text(x, y, option, {
          fontFamily: "Kode Mono",
          fontSize: 14,
          color: "black",
        })
        .setInteractive();
      optionText.on("pointerover", () => {
        this.select.play();
        optionText.setColor("red");
      });
      optionText.on("pointerout", () => {
        optionText.setColor("black");
      });

      optionText.on("pointerdown", () => {
        this.press.play();
        this.checkAnswer(index);
        optionsTexts.forEach((text) => text.destroy());
      });
      optionsTexts.push(optionText);
    });
  }
  checkAnswer(selectedIndex) {
    const currentQuestion = this.questions[this.currentQuestionIndex];

    if (selectedIndex === currentQuestion.correctAnswer) {
      this.hurt.play();
      this.enemyHP -= 25;
      this.healthBarE.decrease(25);
      if (this.enemyHP <= 0) {
        this.scene.start("Victory");
      }
    } else {
      this.hurt.play();
      this.playerHP -= 25;
      this.healthBarP.decrease(25);

      if (this.playerHP <= 0) {
        this.scene.start("Defeat");
      }
    }
    this.currentQuestionIndex++;
    if (this.currentQuestionIndex < this.questions.length) {
      this.questionText.destroy();
      this.displayQuestion();
    } else {
    }
  }
}

class Entretiens4 extends Phaser.Scene {
  constructor() {
    super({ key: "Entretiens4" });
  }
  preload() {
    this.load.image("fishshop", "wendy/image/fishShop.png");
    this.load.image("fisher", "wendy/image/fisher.png");
    this.load.image("dialogueBox", "wendy/image/metalPanel.png");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
    this.load.audio("hurt", "wendy/image/hurt.mp3");
  }

  create() {
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    this.hurt = this.sound.add("hurt");
    const fishshop = this.add
      .image(0, 0, "fishshop")
      .setOrigin(0)
      .setScrollFactor(0);
    fishshop.displayWidth = 1000;
    fishshop.displayHeight = 300;
    this.dialogueBox = this.add.image(310, 100, "dialogueBox");
    this.dialogueBox.setDisplaySize(550, 150);
    this.fisher = this.add.image(750, 100, "fisher");
    this.fisher.setDisplaySize(250, 200);
    this.healthBarE = new HealthBar(this, 125, 50, 200, 15);
    this.add.text(360, 50, "Recruteur", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });

    this.dialogueBoxP = this.add.image(760, 220, "dialogueBox");
    this.dialogueBoxP.setDisplaySize(310, 90);
    this.healthBarP = new HealthBar(this, 650, 190, 200, 15);
    this.add.text(670, 220, "Candidat", {
      fontFamily: "Kode Mono",
      fontSize: 25,
      color: "black",
    });
    this.enemyHP = 100;
    this.playerHP = 100;

    this.dialogueBoxR = this.add.image(310, 250, "dialogueBox");
    this.dialogueBoxR.setDisplaySize(450, 90);

    this.questions = [
      {
        question: "Quelle est votre principale\nqualitÃ© professionnelle ?",
        options: [
          "Ma capacitÃ© Ã  \ntravailler rapidement",
          "Ma fiabilitÃ© et mon \nengagement",
          "Ma capacitÃ© Ã  Ã©viter\nles conflits",
          "Ma capacitÃ© Ã  \nconvaincre les autres",
        ],
        correctAnswer: 1,
      },
      {
        question:
          "Comment dÃ©cririez-vous votre capacitÃ©\nÃ  gÃ©rer plusieurs tÃ¢ches simultanÃ©ment?",
        options: [
          "Je suis facilement \ndÃ©passÃ©",
          "Je prÃ©fÃ¨re me concentrer\nsur une seule tÃ¢che",
          " Je suis capable de \nprioriser efficacement",
          "Je demande toujours de \nl'aide Ã  mes collÃ¨gues",
        ],
        correctAnswer: 2,
      },
      {
        question: "Quelle est votre approche \npour travailler en Ã©quipe ?",
        options: [
          "Prendre le contrÃ´le de\nchaque projet.",
          "En Ã©coutant activement\nles idÃ©es des autres",
          "En Ã©vitant les  \nmembres de l'Ã©quipe.",
          "En critiquant les \ncontributions des autres",
        ],
        correctAnswer: 0,
      },
      {
        question: "Quelle est la meilleure pratique pour\nÃ©viter la surpÃªche ?",
        options: [
          "Augmenter le nombre de \nbateaux de pÃªche",
          "Limiter les pÃ©riodes \nde pÃªche",
          "Utiliser des techniques \nde pÃªche destructrices",
          "Ignorer les quotas de \npÃªche",
        ],
        correctAnswer: 1,
      },
      {
        question:
          "Comment rÃ©agissez-vous face Ã  \nl'incertitude dans votre travail ",
        options: [
          "Je deviens rapidement\nanxieux et dÃ©motivÃ©",
          "Je reste calme et\nj'essaie des solutions",
          "Je fais semblant que \ntout va bien",
          "Je cherche un autre \npour rÃ©soudre le problÃ¨me ",
        ],
        correctAnswer: 1,
      },
      {
        question: "Qu'est-ce que la pÃªche artisanale ?",
        options: [
          "Une pÃªche pratiquÃ©e par\ndes amateurs",
          "Une pÃªche industrielle",
          "Je les considÃ¨re comme\ndes opportunitÃ©s",
          "Une pÃªche traditionnel\n dans de petites embarcations",
        ],
        correctAnswer: 3,
      },
      {
        question: "Citez-moi une qualitÃ© ?",
        options: [
          "Je suis attentif aux  \ndÃ©tails et prÃ©cis",
          "Je suis empathique",
          "Je suis persÃ©vÃ©rant",
          "Je suis extrÃªmement  \ncrÃ©atif",
        ],
        correctAnswer: 0,
      },
    ];
    this.currentQuestionIndex = 0;
    this.displayQuestion();
  }

  displayQuestion() {
    const currentQuestion = this.questions[this.currentQuestionIndex];
    this.questionText = this.add.text(110, 90, currentQuestion.question, {
      fontFamily: "Kode Mono",
      fontSize: 20,
      color: "black",
    });

    const optionsTexts = [];

    currentQuestion.options.forEach((option, index) => {
      let x, y;
      if (index < 2) {
        x = 130 + index * 200;
        y = 225;
      } else {
        x = 130 + (index - 2) * 200;
        y = 260;
      }
      const optionText = this.add
        .text(x, y, option, {
          fontFamily: "Kode Mono",
          fontSize: 14,
          color: "black",
        })
        .setInteractive();
      optionText.on("pointerover", () => {
        this.select.play();
        optionText.setColor("red");
      });
      optionText.on("pointerout", () => {
        optionText.setColor("black");
      });

      optionText.on("pointerdown", () => {
        this.press.play();
        this.checkAnswer(index);
        optionsTexts.forEach((text) => text.destroy());
      });
      optionsTexts.push(optionText);
    });
  }
  checkAnswer(selectedIndex) {
    const currentQuestion = this.questions[this.currentQuestionIndex];

    if (selectedIndex === currentQuestion.correctAnswer) {
      this.hurt.play();
      this.enemyHP -= 25;
      this.healthBarE.decrease(25);
      if (this.enemyHP <= 0) {
        this.scene.start("Victory");
      }
    } else {
      this.hurt.play();
      this.playerHP -= 25;
      this.healthBarP.decrease(25);

      if (this.playerHP <= 0) {
        this.scene.start("Defeat");
      }
    }
    this.currentQuestionIndex++;
    if (this.currentQuestionIndex < this.questions.length) {
      this.questionText.destroy();
      this.displayQuestion();
    } else {
    }
  }
}
class Victory extends Phaser.Scene {
  constructor() {
    super({ key: "Victory" });
  }

  preload() {
    this.load.image("bgvictoire", "wendy/image/bgVictoire.png");
    this.load.image("boutonR", "wendy/image/recommencer.png");
    this.load.image("boutonRhover", "wendy/image/recommencerHover.png");
    this.load.image("quit", "wendy/image/quit.png");
    this.load.image("quitOver", "wendy/image/quitOver.png");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
  }

  create() {
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    const victoire = this.add
      .image(0, 0, "bgvictoire")
      .setOrigin(0)
      .setScrollFactor(0);
    victoire.displayWidth = 1000;
    victoire.displayHeight = 300;
    this.add.text(125, 50, "Contrat dÃ©crochÃ© !", {
      fontFamily: "Kode Mono",
      fontSize: 40,
      color: "black",
    });
    this.buttonR = this.add.image(200, 200, "boutonR").setInteractive();
    this.quit = this.add.image(650, 200, "quit").setInteractive();
    this.buttonR.on("pointerover", () => {
      this.select.play();
      this.buttonR.setTexture("boutonRhover");
    });

    this.buttonR.on("pointerout", () => {
      this.buttonR.setTexture("boutonR");
    });

    this.buttonR.on("pointerdown", () => {
      this.press.play();
      this.scene.start("Map");
    });

    this.quit.on("pointerover", () => {
      this.select.play();
      this.quit.setTexture("quitOver");
    });

    this.quit.on("pointerout", () => {
      this.quit.setTexture("quit");
    });

    this.quit.on("pointerdown", () => {
      this.press.play();
      window.location.reload();
    });
  }
}

class Defeat extends Phaser.Scene {
  constructor() {
    super({ key: "Defeat" });
  }

  preload() {
    this.load.image("bgdefeat", "wendy/image/bgdefaite.png");
    this.load.image("boutonRR", "wendy/image/boutonR.png");
    this.load.image("boutonRRhover", "wendy/image/BoutonRhover.png");
    this.load.image("quitR", "wendy/image/quitR.png");
    this.load.image("quitRover", "wendy/image/QuitRover.png");
    this.load.audio("select", "wendy/image/select.mp3");
    this.load.audio("press", "wendy/image/press.mp3");
  }

  create() {
    this.select = this.sound.add("select");
    this.press = this.sound.add("press");
    const victoire = this.add
      .image(0, 0, "bgdefeat")
      .setOrigin(0)
      .setScrollFactor(0);
    victoire.displayWidth = 1000;
    victoire.displayHeight = 300;
    this.add.text(500, 50, "Contrat non dÃ©crochÃ© !", {
      fontFamily: "Kode Mono",
      fontSize: 40,
      color: "black",
    });
    this.buttonR = this.add.image(400, 200, "boutonRR").setInteractive();
    this.quitR = this.add.image(750, 200, "quitR").setInteractive();

    this.buttonR.on("pointerover", () => {
      this.select.play();
      this.buttonR.setTexture("boutonRRhover");
    });

    this.buttonR.on("pointerout", () => {
      this.buttonR.setTexture("boutonRR");
    });

    this.buttonR.on("pointerdown", () => {
      this.press.play();
      this.scene.start("Map");
    });

    this.quitR.on("pointerover", () => {
      this.select.play();
      this.quitR.setTexture("quitRover");
    });

    this.quitR.on("pointerout", () => {
      this.quitR.setTexture("quitR");
    });

    this.quitR.on("pointerdown", () => {
      this.press.play();
      window.location.reload();
    });
  }
}

const config = {
  type: Phaser.AUTO,
  physics: {
    default: "arcade",
    arcade: {
      gravity: { y: 300 },
    },
  },
  scene: [
    Title,
    CharacterSelection,
    Map,
    Entretiens,
    Entretiens2,
    Entretiens3,
    Entretiens4,
    Victory,
    Defeat,
  ],
  scale: {
    mode: Phaser.Scale.NONE,
    autoCenter: Phaser.Scale.CENTER_BOTH,
    width: 1000,
    height: 300,
  },
};
var game = new Phaser.Game(config);
